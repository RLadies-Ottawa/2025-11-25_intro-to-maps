---
title: "Design your own custom map"
author: "Reiko Okamoto"
format: html
editor: visual
---

Inspiration: <https://mrkyourmoment.com/en-ca/collections/city-prints/products/custom-city-map-1>

## Step 1: Load necessary packages

```{r}
library(tidyverse)
library(osmdata)
library(sf)
library(sysfonts)
library(showtext)
library(grid)
```

## Step 2: Define bounding box

```{r}
# bbox <- ...
```

## Step 3: Build Overpass query

```{r}
# query <- ...
```

## Step 4: Extract OSM data

```{r}
# rivers
# water_a <- ...
```

```{r}
# other bodies of water
# water_b <- ...
```

```{r}
# "major" roads
# roads_a <- ...
```

```{r}
# "minor" roads
# roads_b <- ...
```

```{r}
# natural vegetation
# natural <- ...
```

```{r}
# recreational greenery
# rec <- ...
```

## Step 5: Crop sf objects

```{r}
# bbox_sf <- ...
```

## Step 6: Visualize sf objects

```{r}
# define colour palette
water_colour <- "#d3e1e4"
roads_a_colour <- "#000000"
roads_b_colour <- "#171717"
natural_colour <- "#879682"
rec_colour <- "#c1cbba"
bkgd_colour <- "#f0f0f0"
```

```{r}
# plt <- ...
```

## Step 7: Add text and export

```{r}
# define colour palette
# page_colour <- ...
# text_colour <- ...
# city <- ...
# country <- ...
# coordinates <- ...
```

```{r}
# use Grid Viewports to strategically position map and text
sysfonts::font_add_google("Montserrat", "Montserrat", regular.wt = 200)
png("ottawa-map.png", width = 8, height = 10, units = "in", res = 300)
showtext::showtext_begin()

vp1 <- viewport(x = 0.5, y = 0.5, width = 1, height = 1)
pushViewport(vp1)
grid.rect(gp = gpar(fill = page_colour))
upViewport()

vp2 <- viewport(x = 0.5, y = 0.575, width = 0.9, height = 0.75)
pushViewport(vp2)
print(plt, newpage = FALSE)
upViewport()

vp3 <- viewport(x = 0.75, y = 0.15, width = 0.4, height = 0.06, just = "left")
pushViewport(vp3)
grid.text(
  city, just = "right",
  gp = gpar(fontfamily = "Montserrat", fontsize = 36, col = text_colour)
)
upViewport()

vp4 <- viewport(x = 0.75, y = 0.1, width = 0.4, height = 0.03, just = "left")
pushViewport(vp4)
grid.text(
  country, just = "right",
  gp = gpar(fontfamily = "Montserrat", fontsize = 18, col = text_colour)
)
upViewport()

vp5 <- viewport(x = 0.75, y = 0.065, width = 0.4, height = 0.03, just = "left")
pushViewport(vp5)
grid.text(
  coordinates, just = "right",
  gp = gpar(fontfamily = "Montserrat", fontsize = 18, col = text_colour)
)
upViewport()

showtext::showtext_end()
dev.off()
```

## How to find which features you can plot

```{r}
# keys_to_check <- c("natural", "landuse", "leisure", "water")
# 
# # return all key-value pairs for selected keys within bounding box
# # warning: large bounding boxes can be computationally heavy!
# get_available_tags <- function(key, bbox) {
#   q <- opq(bbox) |> 
#     add_osm_feature(key = key)
#   osm_data <- osmdata_sf(q)
#   
#   # Extract unique values from all geometry types
#   values <- c()
#   if (!is.null(osm_data$osm_points)) 
#     values <- c(values, unique(osm_data$osm_points[[key]]))
#   if (!is.null(osm_data$osm_polygons)) 
#     values <- c(values, unique(osm_data$osm_polygons[[key]]))
#   if (!is.null(osm_data$osm_multipolygons)) 
#     values <- c(values, unique(osm_data$osm_multipolygons[[key]]))
#   
#   return(unique(values[!is.na(values)]))
# }
# 
# for (key in keys_to_check) {
#   values <- get_available_tags(key, bbox)
#   cat(sprintf("%s: %s\n", key, paste(values, collapse=", ")))
# }
```

## References

-   <https://thetidytrekker.com/post/making-circular-maps/making-circular-maps.html>

-   <https://blog.devgenius.io/design-a-map-art-with-r-and-openstreetmap-eac6fc7a912b>
